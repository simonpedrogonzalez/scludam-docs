<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>scludam.synthetic &mdash; scludam 0.0.4 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> scludam
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">scludam (<strong>S</strong>tar <strong>CLU</strong>ster <strong>D</strong>etection <strong>A</strong>nd <strong>M</strong>embership estimation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../diagrams.html">Diagrams</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">scludam</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>scludam.synthetic</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for scludam.synthetic</h1><div class="highlight"><pre>
<span></span><span class="c1"># scludam, Star CLUster Detection And Membership estimation package</span>
<span class="c1"># Copyright (C) 2022  Simón Pedro González</span>

<span class="c1"># This program is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>

<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>

<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>

<span class="sd">&quot;&quot;&quot;Module for synthetic data generation.</span>

<span class="sd">Contains some helpful functions and distributions and the main classes for generating</span>
<span class="sd">synthetic sky region samples with an star field and star clusters.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">numbers</span> <span class="kn">import</span> <span class="n">Number</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">Distance</span><span class="p">,</span> <span class="n">SkyCoord</span>
<span class="kn">from</span> <span class="nn">attrs</span> <span class="kn">import</span> <span class="n">Factory</span><span class="p">,</span> <span class="n">define</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">validators</span>
<span class="kn">from</span> <span class="nn">beartype</span> <span class="kn">import</span> <span class="n">beartype</span>
<span class="kn">from</span> <span class="nn">numpy.typing</span> <span class="kn">import</span> <span class="n">NDArray</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">ConvexHull</span>

<span class="kn">from</span> <span class="nn">scludam.type_utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Numeric1DArray</span><span class="p">,</span>
    <span class="n">Numeric2DArray</span><span class="p">,</span>
    <span class="n">Vector2</span><span class="p">,</span>
    <span class="n">Vector2Array</span><span class="p">,</span>
    <span class="n">Vector3</span><span class="p">,</span>
    <span class="n">Vector3Array</span><span class="p">,</span>
    <span class="n">_type</span><span class="p">,</span>
<span class="p">)</span>


<span class="c1"># Helper functions</span>
<div class="viewcode-block" id="is_inside_circle"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.is_inside_circle">[docs]</a><span class="nd">@beartype</span>
<span class="k">def</span> <span class="nf">is_inside_circle</span><span class="p">(</span>
    <span class="n">center</span><span class="p">:</span> <span class="n">Vector2</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Vector2</span><span class="p">,</span> <span class="n">Vector2Array</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Check if data is inside a circle.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    center : Vector2</span>
<span class="sd">        list, touple of numpy array of 2 number elements, representing the center</span>
<span class="sd">        of the circle</span>
<span class="sd">    radius : Number</span>
<span class="sd">        radius of the circle</span>
<span class="sd">    data : Union[Vector2, Vector2Array]</span>
<span class="sd">        numpy numeric array of shape (n, 2) to check if inside the circle</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    NDArray[bool]</span>
<span class="sd">        mask indicating if data is inside the circle.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">dx</span> <span class="o">&lt;=</span> <span class="n">radius</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">dy</span> <span class="o">&lt;=</span> <span class="n">radius</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">((</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">&lt;=</span> <span class="n">radius</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;=</span> <span class="n">radius</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="is_inside_sphere"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.is_inside_sphere">[docs]</a><span class="nd">@beartype</span>
<span class="k">def</span> <span class="nf">is_inside_sphere</span><span class="p">(</span>
    <span class="n">center</span><span class="p">:</span> <span class="n">Vector3</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Vector3</span><span class="p">,</span> <span class="n">Vector3Array</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Check if data is inside a sphere.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    center : Vector3</span>
<span class="sd">        list, touple of numpy array of 3 number elements, representing the center</span>
<span class="sd">        of the sphere</span>
<span class="sd">    radius : Number</span>
<span class="sd">        radius of the sphere</span>
<span class="sd">    data : Union[Vector3, Vector3Array]</span>
<span class="sd">        numeric array of shape (n, 3) to check if inside the sphere</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    NDArray[bool]</span>
<span class="sd">        mask indicating if data is inside the sphere.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">dz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dz</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;=</span> <span class="n">radius</span><span class="o">**</span><span class="mi">2</span></div>


<span class="c1"># Coordinate transformation</span>
<div class="viewcode-block" id="cartesian_to_polar"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.cartesian_to_polar">[docs]</a><span class="nd">@beartype</span>
<span class="k">def</span> <span class="nf">cartesian_to_polar</span><span class="p">(</span>
    <span class="n">coords</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Vector3</span><span class="p">,</span> <span class="n">Vector3Array</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Vector3</span><span class="p">,</span> <span class="n">Vector3Array</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Convert cartesian coordinates to polar coordinates.</span>

<span class="sd">    Cartesian coordinates are taken as (x, y, z) in parsecs in</span>
<span class="sd">    ICRS system and are transformed to (ra, dec, parallax).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    coords : Union[Vector3, Vector3Array]</span>
<span class="sd">        cartesian coordinates in (x, y, z) in parsecs in ICRS system</span>
<span class="sd">        to be transformed to (ra, dec, parallax).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Union[Vector3, Vector3Array]</span>
<span class="sd">        polar coordinates in (ra, dec, parallax).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">y</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">z</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;pc&quot;</span><span class="p">,</span>
            <span class="n">representation_type</span><span class="o">=</span><span class="s2">&quot;cartesian&quot;</span><span class="p">,</span>
            <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;icrs&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">representation_type</span> <span class="o">=</span> <span class="s2">&quot;spherical&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">coords</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">coords</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">coords</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">parallax</span><span class="o">.</span><span class="n">mas</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">y</span><span class="o">=</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">z</span><span class="o">=</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;pc&quot;</span><span class="p">,</span>
            <span class="n">representation_type</span><span class="o">=</span><span class="s2">&quot;cartesian&quot;</span><span class="p">,</span>
            <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;icrs&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">representation_type</span> <span class="o">=</span> <span class="s2">&quot;spherical&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
            <span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">coords</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">coords</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">parallax</span><span class="o">.</span><span class="n">mas</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">T</span></div>


<div class="viewcode-block" id="polar_to_cartesian"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.polar_to_cartesian">[docs]</a><span class="nd">@beartype</span>
<span class="k">def</span> <span class="nf">polar_to_cartesian</span><span class="p">(</span>
    <span class="n">coords</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Vector3</span><span class="p">,</span> <span class="n">Vector3Array</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Vector3</span><span class="p">,</span> <span class="n">Vector3Array</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Convert polar coordinates to cartesian coordinates.</span>

<span class="sd">    Polar coordinates are taken as (ra, dec, parallax) in (degree, degree, mas)</span>
<span class="sd">    in ICRS system and are transformed to (x, y, z) in parsecs in ICRS system.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    coords : Union[Vector3, Vector3Array]</span>
<span class="sd">        polar coordinates in (ra, dec, parallax) in (degree, degree, mas)</span>
<span class="sd">        in ICRS system.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Union[Vector3, Vector3Array]</span>
<span class="sd">        cartesian coordinates in (x, y, z) in parsecs in ICRS system.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span>
            <span class="n">ra</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span>
            <span class="n">dec</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span>
            <span class="n">distance</span><span class="o">=</span><span class="n">Distance</span><span class="p">(</span><span class="n">parallax</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mas</span><span class="p">),</span>
            <span class="n">representation_type</span><span class="o">=</span><span class="s2">&quot;spherical&quot;</span><span class="p">,</span>
            <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;icrs&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">representation_type</span> <span class="o">=</span> <span class="s2">&quot;cartesian&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">coords</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">coords</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">coords</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">value</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span>
            <span class="n">ra</span><span class="o">=</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span>
            <span class="n">dec</span><span class="o">=</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span>
            <span class="n">distance</span><span class="o">=</span><span class="n">Distance</span><span class="p">(</span><span class="n">parallax</span><span class="o">=</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mas</span><span class="p">),</span>
            <span class="n">representation_type</span><span class="o">=</span><span class="s2">&quot;spherical&quot;</span><span class="p">,</span>
            <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;icrs&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">representation_type</span> <span class="o">=</span> <span class="s2">&quot;cartesian&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">coords</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">coords</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">coords</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">value</span><span class="p">))</span><span class="o">.</span><span class="n">T</span></div>


<span class="c1"># Custom validators</span>
<span class="k">def</span> <span class="nf">_in_range</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">range_validator</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="nb">float</span><span class="p">(</span><span class="n">min_value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">attribute</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> attribute must be &gt;= than </span><span class="si">{</span><span class="n">min_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="nb">float</span><span class="p">(</span><span class="n">max_value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">attribute</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> attribute must be &lt;= than </span><span class="si">{</span><span class="n">max_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">range_validator</span>


<span class="k">def</span> <span class="nf">_dist_has_n_dimensions</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_dist_has_n_dimensions_validator</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">dim</span> <span class="o">!=</span> <span class="n">n</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">attribute</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> attribute must have </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> dimensions,               &quot;</span>
                <span class="sa">f</span><span class="s2">&quot; but has </span><span class="si">{</span><span class="n">value</span><span class="o">.</span><span class="n">dim</span><span class="si">}</span><span class="s2"> dimensions&quot;</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">_dist_has_n_dimensions_validator</span>


<span class="c1"># Custom distributions</span>
<div class="viewcode-block" id="EDSD"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.EDSD">[docs]</a><span class="nd">@define</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">EDSD</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to represent the EDSD distribution.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    w0 : float</span>
<span class="sd">        Distribution zero point that indicates the lower limit</span>
<span class="sd">    wl : float</span>
<span class="sd">        Parameter that determines the width and the peak at wl/4</span>
<span class="sd">        of the profile</span>
<span class="sd">    wf : float</span>
<span class="sd">        Distribution final point that indicates the upper limit</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    EDSD:</span>
<span class="sd">        Distribution object</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If ``wf &lt; w0``, or if a and b, which determine de evaluation</span>
<span class="sd">        domain in scipy.rv_continuous, do not verify ``a &lt; w0``, ``b &gt; wf``</span>
<span class="sd">        and ``b &gt; a``.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Exponentially Decreasing Space Density is used to represent</span>
<span class="sd">    certain distributions, such as a parallax distribution of a</span>
<span class="sd">    star catalogue [1]_ [2]_. The EDSD distribution is defined as:</span>

<span class="sd">    *  ``f(w) = wl**3 / 2*(w-w0)**4 * exp(-wl/(w-w0))`` if ``w &gt; w0`` and ``w &lt; wf``</span>
<span class="sd">    *  ``f(w) = 0`` if ``w &lt;= w0``</span>
<span class="sd">    *  ``f(w) = 0`` if ``w &gt;= wf``</span>

<span class="sd">    where:</span>

<span class="sd">    *   ``w``: parallax in mas</span>
<span class="sd">    *   ``w0``:  distribution zero point that indicates the lower limit</span>
<span class="sd">    *   ``wl``: parameter that determines the width and the peak at wl/4</span>
<span class="sd">        of the profile</span>
<span class="sd">    *   ``wf``: distribution final point that indicates the upper limit</span>
<span class="sd">        from which the distribution is zero. This is added to make</span>
<span class="sd">        the function domain limited to ``[w0, wf]``, so other</span>
<span class="sd">        values outside this range are not evaluated.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] C. A. L. Bailer-Jones et al. (2018). Estimating Distance from Parallaxes,</span>
<span class="sd">        IV, Distances to 1.33 Billion Stars in Gaia Data Release 2. The Astronomical</span>
<span class="sd">        Journal, 156:58 (11pp), 2018 August. https://doi.org/10.3847/1538-3881/aacb21</span>

<span class="sd">    .. [2] Z. Shao &amp; L. Li (2019). Gaia Parallax of Milky Way</span>
<span class="sd">        Globular Clusters: A Solution</span>
<span class="sd">        of Mixture Model. https://www.researchgate.net/publication/335233416</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    .. literalinclude :: ../../examples/synthetic/edsd.py</span>
<span class="sd">        :language: python</span>
<span class="sd">        :linenos:</span>
<span class="sd">    .. image:: ../../examples/synthetic/edsd.png</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">w0</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">wl</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">wf</span><span class="p">:</span> <span class="nb">float</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w0</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">wl</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">wf</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_argcheck</span><span class="p">(</span><span class="n">w0</span><span class="p">,</span> <span class="n">wl</span><span class="p">,</span> <span class="n">wf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w0</span> <span class="o">=</span> <span class="n">w0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wl</span> <span class="o">=</span> <span class="n">wl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wf</span> <span class="o">=</span> <span class="n">wf</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">wl</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">wf</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">piecewise</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span>
            <span class="p">[(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">w0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">wf</span><span class="p">)],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">wl</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">w0</span><span class="p">))</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">wl</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">w0</span><span class="p">))],</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">wl</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">wf</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="o">-</span><span class="mf">0.007</span> <span class="o">*</span> <span class="n">wl</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">0.087</span> <span class="o">*</span> <span class="n">wl</span> <span class="o">-</span> <span class="mf">0.12</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">w0</span>
            <span class="o">+</span> <span class="p">(</span><span class="mf">0.17</span> <span class="o">+</span> <span class="mf">0.076</span> <span class="o">*</span> <span class="n">wl</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="o">**</span><span class="mi">4</span>
            <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">0.037</span> <span class="o">*</span> <span class="n">wl</span> <span class="o">+</span> <span class="mf">0.0048</span> <span class="o">*</span> <span class="n">wl</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="o">*</span> <span class="n">wl</span>
            <span class="o">/</span> <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">6</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">wl</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">wf</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">piecewise</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span>
            <span class="p">[</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">w0</span><span class="p">,</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">wf</span><span class="p">],</span>
            <span class="p">[</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="mi">1</span><span class="p">,</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span>
                    <span class="p">(</span>
                        <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
                        <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">wl</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">w0</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span>
                        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">w0</span><span class="o">**</span><span class="mi">2</span>
                        <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">wl</span> <span class="o">*</span> <span class="n">w0</span>
                        <span class="o">+</span> <span class="n">wl</span><span class="o">**</span><span class="mi">2</span>
                    <span class="p">)</span>
                    <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">wl</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">w0</span><span class="p">))</span>
                    <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">w0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="p">),</span>
            <span class="p">],</span>
        <span class="p">)</span>

<div class="viewcode-block" id="EDSD.pdf"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.EDSD.pdf">[docs]</a>    <span class="k">def</span> <span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Number</span><span class="p">,</span> <span class="n">Numeric1DArray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Numeric1DArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Probability density function of the EDSD distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : Union[Number, Numeric1DArray]</span>
<span class="sd">            Data to be evaluated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Numeric1DArray</span>
<span class="sd">            PDF values.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The PDF is defined as the density profile given in [1]_ [2]_, but it is</span>
<span class="sd">        not used for random generation. Instead, a Percent Point Function</span>
<span class="sd">        approximation is used.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wf</span><span class="p">)</span></div>

<div class="viewcode-block" id="EDSD.cdf"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.EDSD.cdf">[docs]</a>    <span class="k">def</span> <span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Number</span><span class="p">,</span> <span class="n">Numeric1DArray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Numeric1DArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Cumulative distribution function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : Numeric1DArray</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Numeric1DArray</span>
<span class="sd">            Cumulative distribution function.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The CDF is a polinomial approximation of the real CDF</span>
<span class="sd">        function.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wf</span><span class="p">)</span></div>

<div class="viewcode-block" id="EDSD.ppf"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.EDSD.ppf">[docs]</a>    <span class="k">def</span> <span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Number</span><span class="p">,</span> <span class="n">Numeric1DArray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Numeric1DArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Percent point function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        y : Numeric1DArray</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Numeric1DArray</span>
<span class="sd">            Percent point function.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The PPF is a polinomial approximation of the real PPF. As cdf and</span>
<span class="sd">        ppf are approximations, one is close to the inverse of the other,</span>
<span class="sd">        but not exactly.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ppf</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wf</span><span class="p">)</span></div>

    <span class="nd">@beartype</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wl</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span> <span class="n">w0</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span> <span class="n">wf</span><span class="p">:</span> <span class="n">Number</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">w0</span> <span class="o">&lt;</span> <span class="n">wf</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;w0 must be &lt; than wf&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;a must be &lt; than b&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">wf</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">wf</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;a must be &lt; than wf&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

<div class="viewcode-block" id="EDSD.rvs"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.EDSD.rvs">[docs]</a>    <span class="k">def</span> <span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Numeric1DArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Generate random variates from the EDSD distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : int, optional</span>
<span class="sd">            Size of the sample, by default 1</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Numeric1DArray</span>
<span class="sd">            Generated sample.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wl</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">wf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_argcheck</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">wf</span><span class="p">)</span>
        <span class="n">limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">w0</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">wf</span> <span class="o">-</span> <span class="mf">1e-10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
            <span class="s2">&quot;float64&quot;</span>
        <span class="p">)</span>
        <span class="n">rv_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="n">limits</span><span class="p">,</span> <span class="n">wl</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">wf</span><span class="p">)</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">while</span> <span class="n">sample</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="n">rv_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">high</span><span class="o">=</span><span class="n">rv_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
            <span class="n">new_sample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ppf</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">wl</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">wf</span><span class="p">)</span>
            <span class="n">new_sample</span> <span class="o">=</span> <span class="n">new_sample</span><span class="p">[</span>
                <span class="p">(</span><span class="n">new_sample</span> <span class="o">&gt;=</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">new_sample</span> <span class="o">&lt;=</span> <span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="p">]</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">sample</span><span class="p">,</span> <span class="n">new_sample</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sample</span><span class="p">[:</span><span class="n">size</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="UniformSphere"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.UniformSphere">[docs]</a><span class="nd">@define</span>
<span class="k">class</span> <span class="nc">UniformSphere</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">_multivariate</span><span class="o">.</span><span class="n">multi_rv_frozen</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to represent the Uniform Sphere distribution.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    center : Vector3</span>
<span class="sd">        Center of the sphere.</span>
<span class="sd">    radius : Number</span>
<span class="sd">        Radius of the sphere.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">center</span><span class="p">:</span> <span class="n">Vector3</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="n">_type</span><span class="p">(</span><span class="n">Vector3</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
    <span class="n">radius</span><span class="p">:</span> <span class="n">Number</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="n">_type</span><span class="p">(</span><span class="n">Number</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<div class="viewcode-block" id="UniformSphere.rvs"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.UniformSphere.rvs">[docs]</a>    <span class="nd">@beartype</span>
    <span class="k">def</span> <span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Vector3Array</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Generate random sample from the Uniform Sphere distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : int, optional</span>
<span class="sd">            Number of samples to be generated, by default 1</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Vector3Array :</span>
<span class="sd">            Numpy numeric array of shape (size, 3) with the samples.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">cos_theta</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">cos_theta</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span><span class="o">.</span><span class="n">T</span></div>

<div class="viewcode-block" id="UniformSphere.pdf"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.UniformSphere.pdf">[docs]</a>    <span class="nd">@beartype</span>
    <span class="k">def</span> <span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Vector3</span><span class="p">,</span> <span class="n">Vector3Array</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Numeric1DArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Probability density function of the Uniform Sphere distribution.</span>

<span class="sd">        Is calculated as 0 if the point is outside the sphere,</span>
<span class="sd">        and 1 divided by the volume of the sphere otherwise.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : Union[Vector3, Vector3Array]</span>
<span class="sd">            Data to be evaluated</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Numeric1DArray</span>
<span class="sd">            Numpy numeric array of shape (size,) with the pdf values.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_inside</span> <span class="o">=</span> <span class="n">is_inside_sphere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">is_inside</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">res</span><span class="p">[</span><span class="n">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div></div>


<div class="viewcode-block" id="UniformFrustum"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.UniformFrustum">[docs]</a><span class="nd">@define</span>
<span class="k">class</span> <span class="nc">UniformFrustum</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">_multivariate</span><span class="o">.</span><span class="n">multi_rv_frozen</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to represent the Uniform Frustum distribution.</span>

<span class="sd">    It was defined to represent a square sky region sample. It</span>
<span class="sd">    represents a uniform distribution inside a pyramidal frustum.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    locs : Vector3</span>
<span class="sd">        Reference corner of the frustum. It is given by (ra, dec, parallax)</span>
<span class="sd">        polar coordinates in ICRS system, in (degree, degree, mas).</span>
<span class="sd">    scales : Vector3</span>
<span class="sd">        Size of the frustum in (ra, dec, parallax) polar coordinates in ICRS,</span>
<span class="sd">        in (degree, degree, mas).</span>
<span class="sd">    max_size_per_iter: int, optional</span>
<span class="sd">        Maximum number of samples to be generated per iteration, by default</span>
<span class="sd">        1e7. A bigger value can reduce the amount of time needed to</span>
<span class="sd">        generate the sample, but take more memory.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    .. literalinclude :: ../../examples/synthetic/uniform_frustum.py</span>
<span class="sd">        :language: python</span>
<span class="sd">        :linenos:</span>
<span class="sd">    .. image:: ../../examples/synthetic/uniform_frustum.png</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">locs</span><span class="p">:</span> <span class="n">Vector3</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="n">_type</span><span class="p">(</span><span class="n">Vector3</span><span class="p">))</span>
    <span class="n">scales</span><span class="p">:</span> <span class="n">Vector3</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="n">_type</span><span class="p">(</span><span class="n">Vector3</span><span class="p">))</span>
    <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_size_per_iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e7</span><span class="p">),</span> <span class="n">validator</span><span class="o">=</span><span class="n">_type</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_get_vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">,</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="p">),</span>
                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="p">),</span>
                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="p">),</span>
                <span class="c1"># (</span>
                <span class="c1">#     self.locs[0] + self.scales[0] / 2,</span>
                <span class="c1">#     self.locs[1] + self.scales[1] / 2,</span>
                <span class="c1">#     self.locs[2],</span>
                <span class="c1"># ),</span>
                <span class="c1"># (</span>
                <span class="c1">#     self.locs[0] + self.scales[0] / 2,</span>
                <span class="c1">#     self.locs[1] + self.scales[1] / 2,</span>
                <span class="c1">#     self.locs[2] + self.scales[2],</span>
                <span class="c1"># ),</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="n">polar_to_cartesian</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid ICRS polar coordinate for locs.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vertices</span>

    <span class="k">def</span> <span class="nf">_is_inside_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Numeric2DArray</span><span class="p">):</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">polar</span> <span class="o">=</span> <span class="n">cartesian_to_polar</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="n">cartesian_to_polar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_vertices</span><span class="p">())</span>

        <span class="n">ramax</span><span class="p">,</span> <span class="n">decmax</span><span class="p">,</span> <span class="n">plxmax</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">vertices</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">ramin</span><span class="p">,</span> <span class="n">decmin</span><span class="p">,</span> <span class="n">plxmin</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">vertices</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

        <span class="n">mask</span><span class="p">[</span>
            <span class="p">(</span><span class="n">polar</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">ramin</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">polar</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ramax</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">polar</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">decmin</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">polar</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">decmax</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">polar</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">plxmin</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">polar</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">plxmax</span><span class="p">)</span>
        <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="c1"># volume of a sqare based piramidal frustum</span>
    <span class="c1"># which base is given by locs. TODO: improve.</span>
    <span class="k">def</span> <span class="nf">_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_vertices</span><span class="p">()</span>
        <span class="n">hull</span> <span class="o">=</span> <span class="n">ConvexHull</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">hull</span><span class="o">.</span><span class="n">volume</span>

<div class="viewcode-block" id="UniformFrustum.rvs"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.UniformFrustum.rvs">[docs]</a>    <span class="nd">@beartype</span>
    <span class="k">def</span> <span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Vector3Array</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Generate random sample from the Uniform Frustum distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : int, optional</span>
<span class="sd">            size of the random sample, by default 1</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Vector3Array :</span>
<span class="sd">            numpy numeric array of shape (size, 3) with the samples.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the given locs are not a valid ICRS coordinate.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">extremes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_vertices</span><span class="p">()</span>

        <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">extremes</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">zmin</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">extremes</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

        <span class="n">size_per_iter</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
            <span class="nb">int</span><span class="p">((</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">zmax</span> <span class="o">-</span> <span class="n">zmin</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volume</span><span class="p">()</span> <span class="o">*</span> <span class="n">size</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_size_per_iter</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">while</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size_per_iter</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size_per_iter</span><span class="p">)</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">zmin</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">zmax</span> <span class="o">-</span> <span class="n">zmin</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size_per_iter</span><span class="p">)</span>
            <span class="n">current_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
            <span class="n">current_data</span> <span class="o">=</span> <span class="n">current_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_is_inside_shape</span><span class="p">(</span><span class="n">current_data</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">current_data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">current_data</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="n">size</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="UniformFrustum.pdf"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.UniformFrustum.pdf">[docs]</a>    <span class="nd">@beartype</span>
    <span class="k">def</span> <span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Vector3</span><span class="p">,</span> <span class="n">Vector3Array</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Numeric1DArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Probability density function of the Uniform Frustum distribution.</span>

<span class="sd">        It is defined as 1 / volume of the frustum for the points inside the frustum,</span>
<span class="sd">        and 0 for the points outside.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : Union[Vector3, Vector3Array]</span>
<span class="sd">            numpy numeric array to be evaluated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Numeric1DArray :</span>
<span class="sd">            PFD values.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the given locs are not a valid ICRS coordinate.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">res</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_is_inside_shape</span><span class="p">(</span><span class="n">data</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">res</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volume</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="UniformCircle"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.UniformCircle">[docs]</a><span class="nd">@define</span>
<span class="k">class</span> <span class="nc">UniformCircle</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">_multivariate</span><span class="o">.</span><span class="n">multi_rv_frozen</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Uniform Circle distribution.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    center : Vector2</span>
<span class="sd">        center of the circle.</span>
<span class="sd">    radius : Number</span>
<span class="sd">        radius of the circle.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">center</span><span class="p">:</span> <span class="n">Vector2</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="n">_type</span><span class="p">(</span><span class="n">Vector2</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
    <span class="n">radius</span><span class="p">:</span> <span class="n">Number</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="n">_type</span><span class="p">(</span><span class="n">Number</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<div class="viewcode-block" id="UniformCircle.pdf"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.UniformCircle.pdf">[docs]</a>    <span class="nd">@beartype</span>
    <span class="k">def</span> <span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Vector2</span><span class="p">,</span> <span class="n">Vector2Array</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Numeric1DArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Probability density function of the Uniform Circle distribution.</span>

<span class="sd">        It is defined as 1 / (pi * radius^2) for the points inside the circle,</span>
<span class="sd">        and 0 for the points outside.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x :  Union[Vector2, Vector2Array]</span>
<span class="sd">            numpy numeric array to be evaluated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Numeric1DArray :</span>
<span class="sd">            Numpy numeric array of shape with the pdf values.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_inside</span> <span class="o">=</span> <span class="n">is_inside_circle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">is_inside</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">res</span><span class="p">[</span><span class="n">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="UniformCircle.rvs"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.UniformCircle.rvs">[docs]</a>    <span class="nd">@beartype</span>
    <span class="k">def</span> <span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Vector2Array</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Generate random sample from the Uniform Circle distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : int, optional</span>
<span class="sd">            size of the random sample, by default 1</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Vector2Array :</span>
<span class="sd">            Numpy numeric array of shape (size, 2) with the samples.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span><span class="o">.</span><span class="n">T</span></div></div>


<div class="viewcode-block" id="BivariateUniform"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.BivariateUniform">[docs]</a><span class="nd">@define</span>
<span class="k">class</span> <span class="nc">BivariateUniform</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">_multivariate</span><span class="o">.</span><span class="n">multi_rv_frozen</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Bivariate Uniform distribution.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    locs : Vector2</span>
<span class="sd">        center of the bivariate uniform distribution.</span>
<span class="sd">    scales : Vector2</span>
<span class="sd">        scale of the bivariate uniform distribution.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    BivariateUniform :</span>
<span class="sd">        instance of the Bivariate Uniform distribution.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">locs</span><span class="p">:</span> <span class="n">Vector2</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="n">_type</span><span class="p">(</span><span class="n">Vector2</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
    <span class="n">scales</span><span class="p">:</span> <span class="n">Vector2</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="n">_type</span><span class="p">(</span><span class="n">Vector2</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
    <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<div class="viewcode-block" id="BivariateUniform.rvs"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.BivariateUniform.rvs">[docs]</a>    <span class="nd">@beartype</span>
    <span class="k">def</span> <span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Vector2Array</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Generate random sample from the Bivariate Uniform distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : int, optional</span>
<span class="sd">            size of the sample, by default 1</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Vector2Array :</span>
<span class="sd">            numpy array of shape (size, 2) with the samples.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span><span class="o">.</span><span class="n">T</span></div>

<div class="viewcode-block" id="BivariateUniform.pdf"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.BivariateUniform.pdf">[docs]</a>    <span class="nd">@beartype</span>
    <span class="k">def</span> <span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Vector2</span><span class="p">,</span> <span class="n">Vector2Array</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Numeric1DArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Probability density function of the Bivariate Uniform distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : Union[Vector2, Vector2Array]</span>
<span class="sd">            data to be evaluated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Numeric1DArray :</span>
<span class="sd">            numpy array with the pdf values.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pdfx</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">pdfy</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">pdfx</span> <span class="o">*</span> <span class="n">pdfy</span></div></div>


<div class="viewcode-block" id="TrivariateUniform"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.TrivariateUniform">[docs]</a><span class="nd">@define</span>
<span class="k">class</span> <span class="nc">TrivariateUniform</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">_multivariate</span><span class="o">.</span><span class="n">multi_rv_frozen</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Trivariate Uniform distribution.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    locs : Vector3</span>
<span class="sd">        center of the trivariate uniform distribution.</span>
<span class="sd">    scales : Vector3</span>
<span class="sd">        scale of the trivariate uniform distribution.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    TrivariateUniform :</span>
<span class="sd">        instance of the Trivariate Uniform distribution.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">locs</span><span class="p">:</span> <span class="n">Vector3</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="n">_type</span><span class="p">(</span><span class="n">Vector3</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
    <span class="n">scales</span><span class="p">:</span> <span class="n">Vector3</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="n">_type</span><span class="p">(</span><span class="n">Vector3</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
    <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<div class="viewcode-block" id="TrivariateUniform.rvs"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.TrivariateUniform.rvs">[docs]</a>    <span class="nd">@beartype</span>
    <span class="k">def</span> <span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Vector3Array</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Generate random sample from the Trivariate Uniform distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : int, optional</span>
<span class="sd">            size of the sample, by default 1</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Vector3Array :</span>
<span class="sd">            Numpy array of shape (size, 3) with the samples.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span><span class="o">.</span><span class="n">T</span></div>

<div class="viewcode-block" id="TrivariateUniform.pdf"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.TrivariateUniform.pdf">[docs]</a>    <span class="nd">@beartype</span>
    <span class="k">def</span> <span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Vector3</span><span class="p">,</span> <span class="n">Vector3Array</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Numeric1DArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Probability density function of the Trivariate Uniform distribution.</span>

<span class="sd">        Is defined as 1 / volume for the points inside the volume, and 0 for</span>
<span class="sd">        the points outside.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : Union[Vector3, Vector3Array]</span>
<span class="sd">            Points to be evaluated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Numeric1DArray :</span>
<span class="sd">            Numpy array with the pdf values.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pdfx</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">pdfy</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">pdfz</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">pdfx</span> <span class="o">*</span> <span class="n">pdfy</span> <span class="o">*</span> <span class="n">pdfz</span></div></div>


<span class="c1"># Data generators</span>
<div class="viewcode-block" id="StarCluster"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.StarCluster">[docs]</a><span class="nd">@define</span>
<span class="k">class</span> <span class="nc">StarCluster</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class for generating astrometric data from a star cluster.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    space : stats._multivariate.multi_rv_frozen</span>
<span class="sd">        Space distribution of the cluster. It must have 3 dimensions.</span>
<span class="sd">    pm : stats._multivariate.multi_rv_frozen</span>
<span class="sd">        Proper motion distribution of the cluster. It must have 3 dimensions.</span>
<span class="sd">    representation_type : str</span>
<span class="sd">        Type of representation of the cluster. It must be &quot;spherical&quot; or &quot;cartesian&quot;,</span>
<span class="sd">        by default &quot;spherical&quot;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    StarCluster :</span>
<span class="sd">        An instance of the StarCluster class.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">space</span><span class="p">:</span> <span class="n">stats</span><span class="o">.</span><span class="n">_multivariate</span><span class="o">.</span><span class="n">multi_rv_frozen</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">validator</span><span class="o">=</span><span class="p">[</span>
            <span class="n">_type</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">_multivariate</span><span class="o">.</span><span class="n">multi_rv_frozen</span><span class="p">),</span>
            <span class="n">_dist_has_n_dimensions</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">pm</span><span class="p">:</span> <span class="n">stats</span><span class="o">.</span><span class="n">_multivariate</span><span class="o">.</span><span class="n">multi_rv_frozen</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">validator</span><span class="o">=</span><span class="p">[</span>
            <span class="n">_type</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">_multivariate</span><span class="o">.</span><span class="n">multi_rv_frozen</span><span class="p">),</span>
            <span class="n">_dist_has_n_dimensions</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">representation_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">validator</span><span class="o">=</span><span class="p">[</span><span class="n">_type</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">validators</span><span class="o">.</span><span class="n">in_</span><span class="p">([</span><span class="s2">&quot;cartesian&quot;</span><span class="p">,</span> <span class="s2">&quot;spherical&quot;</span><span class="p">])],</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;spherical&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">n_stars</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="p">[</span><span class="n">_type</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">_in_range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;inf&quot;</span><span class="p">)],</span> <span class="n">default</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

    <span class="c1"># TODO: fails when n is 1</span>
<div class="viewcode-block" id="StarCluster.rvs"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.StarCluster.rvs">[docs]</a>    <span class="k">def</span> <span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Generate random sample from the Star Cluster distribution.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            Data frame with the samples.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_stars</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">representation_type</span> <span class="o">==</span> <span class="s2">&quot;spherical&quot;</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;parallax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cartesian_to_polar</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
        <span class="n">pm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
        <span class="n">data</span><span class="p">[[</span><span class="s2">&quot;pmra&quot;</span><span class="p">,</span> <span class="s2">&quot;pmdec&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pm</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="StarCluster.pdf"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.StarCluster.pdf">[docs]</a>    <span class="k">def</span> <span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Numeric1DArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Joint probability density function of the StarCluster distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : pd.DataFrame</span>
<span class="sd">            Data to be evaluated. Must contain the columns &quot;ra&quot;, &quot;dec&quot;, &quot;parallax&quot;</span>
<span class="sd">            or &quot;x&quot;, &quot;y&quot;, &quot;z&quot;, and &quot;pmra&quot;, &quot;pmdec&quot;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Numeric1DArray</span>
<span class="sd">            PDF values for the data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pm_pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s2">&quot;pmra&quot;</span><span class="p">,</span> <span class="s2">&quot;pmdec&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
            <span class="n">space_pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="n">polar_to_cartesian</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;parallax&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
            <span class="n">space_pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pm_pdf</span> <span class="o">*</span> <span class="n">space_pdf</span></div>

<div class="viewcode-block" id="StarCluster.pm_pdf"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.StarCluster.pm_pdf">[docs]</a>    <span class="k">def</span> <span class="nf">pm_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Numeric1DArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Probability density function of the Proper Motion distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : pd.DataFrame</span>
<span class="sd">            Data to be evaluated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Numeric1DArray</span>
<span class="sd">            PDF values for the data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s2">&quot;pmra&quot;</span><span class="p">,</span> <span class="s2">&quot;pmdec&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span></div>

<div class="viewcode-block" id="StarCluster.space_pdf"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.StarCluster.space_pdf">[docs]</a>    <span class="k">def</span> <span class="nf">space_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Numeric1DArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Probability density function of the space distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : pd.DataFrame</span>
<span class="sd">            Data to be evaluated. Must have columns &quot;x&quot;, &quot;y&quot;, &quot;z&quot; or</span>
<span class="sd">            &quot;ra&quot;, &quot;dec&quot;, &quot;parallax&quot;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Numeric1DArray</span>
<span class="sd">            PDF values for the data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
            <span class="n">space_pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="n">polar_to_cartesian</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;parallax&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
            <span class="n">space_pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">space_pdf</span></div></div>


<div class="viewcode-block" id="StarField"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.StarField">[docs]</a><span class="nd">@define</span>
<span class="k">class</span> <span class="nc">StarField</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class for generating star field data.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    space : stats._multivariate.multi_rv_frozen</span>
<span class="sd">        Distribution of the space coordinates. Must have 3 dimensions.</span>
<span class="sd">    pm : stats._multivariate.multi_rv_frozen</span>
<span class="sd">        Distribution of the proper motion coordinates. Must have 2 dimensions.</span>
<span class="sd">    representation_type : str</span>
<span class="sd">        Type of representation of the spatial data. Must be &quot;cartesian&quot; or &quot;spherical&quot;,</span>
<span class="sd">        by default &quot;spherical&quot;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    StarField :</span>
<span class="sd">        An instance of the StarField class.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">space</span><span class="p">:</span> <span class="n">stats</span><span class="o">.</span><span class="n">_multivariate</span><span class="o">.</span><span class="n">multi_rv_frozen</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">validator</span><span class="o">=</span><span class="p">[</span>
            <span class="n">_type</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">_multivariate</span><span class="o">.</span><span class="n">multi_rv_frozen</span><span class="p">),</span>
            <span class="n">_dist_has_n_dimensions</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">pm</span><span class="p">:</span> <span class="n">stats</span><span class="o">.</span><span class="n">_multivariate</span><span class="o">.</span><span class="n">multi_rv_frozen</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">validator</span><span class="o">=</span><span class="p">[</span>
            <span class="n">_type</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">_multivariate</span><span class="o">.</span><span class="n">multi_rv_frozen</span><span class="p">),</span>
            <span class="n">_dist_has_n_dimensions</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">representation_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">validator</span><span class="o">=</span><span class="p">[</span><span class="n">_type</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">validators</span><span class="o">.</span><span class="n">in_</span><span class="p">([</span><span class="s2">&quot;cartesian&quot;</span><span class="p">,</span> <span class="s2">&quot;spherical&quot;</span><span class="p">])],</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;spherical&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">n_stars</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="p">[</span><span class="n">_type</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">_in_range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;inf&quot;</span><span class="p">)],</span> <span class="n">default</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e5</span><span class="p">))</span>

    <span class="c1"># TODO: test</span>
<div class="viewcode-block" id="StarField.rvs"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.StarField.rvs">[docs]</a>    <span class="k">def</span> <span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Generate random sample from the Star Field distribution.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            Contains columns for the space distrubution and the pm distribution.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_stars</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
        <span class="n">pm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
        <span class="n">data</span><span class="p">[[</span><span class="s2">&quot;pmra&quot;</span><span class="p">,</span> <span class="s2">&quot;pmdec&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">pm</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pm</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">representation_type</span> <span class="o">==</span> <span class="s2">&quot;spherical&quot;</span><span class="p">:</span>
            <span class="n">ra_dec_plx</span> <span class="o">=</span> <span class="n">cartesian_to_polar</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[[</span><span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;parallax&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ra_dec_plx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span></div>

    <span class="c1"># TODO: test</span>
<div class="viewcode-block" id="StarField.pdf"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.StarField.pdf">[docs]</a>    <span class="k">def</span> <span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Numeric1DArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Joint Probability Density Function of the Star Field.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : pd.DataFrame</span>
<span class="sd">            Data to be evaluated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Numeric1DArray</span>
<span class="sd">            PDF values for the data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pm_pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s2">&quot;pmra&quot;</span><span class="p">,</span> <span class="s2">&quot;pmdec&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
            <span class="n">space_pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="n">polar_to_cartesian</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;parallax&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
            <span class="n">space_pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pm_pdf</span> <span class="o">*</span> <span class="n">space_pdf</span></div>

<div class="viewcode-block" id="StarField.pm_pdf"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.StarField.pm_pdf">[docs]</a>    <span class="k">def</span> <span class="nf">pm_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Numeric1DArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Probability density function of the Proper Motion distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : pd.DataFrame</span>
<span class="sd">            Data to be evaluated. Must have columns &quot;pmra&quot; and &quot;pmdec&quot;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Numeric1DArray</span>
<span class="sd">            PDF of the Proper Motion distribution.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s2">&quot;pmra&quot;</span><span class="p">,</span> <span class="s2">&quot;pmdec&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span></div>

<div class="viewcode-block" id="StarField.space_pdf"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.StarField.space_pdf">[docs]</a>    <span class="k">def</span> <span class="nf">space_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Numeric1DArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Probability density function of the space distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : pd.DataFrame</span>
<span class="sd">            Data to be evaluated. Must have columns &quot;x&quot;, &quot;y&quot;, &quot;z&quot;</span>
<span class="sd">            or &quot;ra&quot;, &quot;dec&quot;, &quot;parallax&quot;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Numeric1DArray</span>
<span class="sd">            PDF of the space distribution.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
            <span class="n">space_pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="n">polar_to_cartesian</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;parallax&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
            <span class="n">space_pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">space_pdf</span></div></div>


<div class="viewcode-block" id="Synthetic"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.Synthetic">[docs]</a><span class="nd">@define</span>
<span class="k">class</span> <span class="nc">Synthetic</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class for generating synthetic data.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    space : stats._multivariate.multi_rv_frozen</span>
<span class="sd">        The space distribution, it must be a 3d distribution.</span>
<span class="sd">    pm : stats._multivariate.multi_rv_frozen</span>
<span class="sd">        The proper motion distribution, it must be a 2d distribution.</span>
<span class="sd">    representation_type : str</span>
<span class="sd">        The representation type, it must be &quot;cartesian&quot; or &quot;spherical&quot;,</span>
<span class="sd">        by default is &quot;spherical&quot;.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    .. literalinclude:: ../../examples/synthetic/synthetic.py</span>
<span class="sd">        :language: python</span>
<span class="sd">        :linenos:</span>
<span class="sd">    .. image:: ../../examples/synthetic/synthetic.png</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">star_field</span><span class="p">:</span> <span class="n">StarField</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="n">_type</span><span class="p">(</span><span class="n">StarField</span><span class="p">))</span>
    <span class="n">representation_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">validator</span><span class="o">=</span><span class="p">[</span><span class="n">_type</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">validators</span><span class="o">.</span><span class="n">in_</span><span class="p">([</span><span class="s2">&quot;cartesian&quot;</span><span class="p">,</span> <span class="s2">&quot;spherical&quot;</span><span class="p">])],</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;spherical&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">clusters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">StarCluster</span><span class="p">]</span> <span class="o">=</span> <span class="n">Factory</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># TODO: test</span>
<div class="viewcode-block" id="Synthetic.rvs"><a class="viewcode-back" href="../../scludam.synthetic.html#scludam.synthetic.Synthetic.rvs">[docs]</a>    <span class="k">def</span> <span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Generate synthetic data from field and cluster distributions.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            synthetic data with columns for the space distribution, the proper motion</span>
<span class="sd">            distribution and approximations of the membership probabilities without</span>
<span class="sd">            taking into account any errors.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">star_field</span><span class="o">.</span><span class="n">representation_type</span> <span class="o">=</span> <span class="s2">&quot;cartesian&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">star_field</span><span class="o">.</span><span class="n">rvs</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">representation_type</span> <span class="o">=</span> <span class="s2">&quot;cartesian&quot;</span>
            <span class="n">cluster_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">rvs</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data</span><span class="p">,</span> <span class="n">cluster_data</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># TODO: improve</span>
        <span class="n">total_stars</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">n_stars</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="p">])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">star_field</span><span class="o">.</span><span class="n">n_stars</span>
        <span class="n">field_mixing_ratio</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">star_field</span><span class="o">.</span><span class="n">n_stars</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">total_stars</span><span class="p">)</span>
        <span class="n">field_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">star_field</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="n">field_mixing_ratio</span>

        <span class="n">field_pmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">star_field</span><span class="o">.</span><span class="n">pm_pdf</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="n">field_mixing_ratio</span>
        <span class="n">field_spacep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">star_field</span><span class="o">.</span><span class="n">space_pdf</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="n">field_mixing_ratio</span>

        <span class="n">clusters_mixing_ratios</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">n_stars</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">total_stars</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span>
        <span class="p">]</span>
        <span class="n">cluster_ps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="n">clusters_mixing_ratios</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="p">))</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="n">cluster_pmps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pm_pdf</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="n">clusters_mixing_ratios</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="p">))</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">cluster_spaceps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">space_pdf</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="n">clusters_mixing_ratios</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="p">))</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="n">total_p</span> <span class="o">=</span> <span class="n">cluster_ps</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">field_p</span>
        <span class="n">total_pmp</span> <span class="o">=</span> <span class="n">cluster_pmps</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">field_pmp</span>
        <span class="n">total_spacep</span> <span class="o">=</span> <span class="n">cluster_spaceps</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">field_spacep</span>

        <span class="n">total_clusters_probs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">total_clusters_pmprobs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">total_clusters_spaceprobs</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="p">)):</span>
            <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;p_cluster</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cluster_ps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_p</span>
            <span class="n">total_clusters_probs</span> <span class="o">+=</span> <span class="n">cluster_ps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_p</span>

            <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;p_pm_cluster</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cluster_pmps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_pmp</span>
            <span class="n">total_clusters_pmprobs</span> <span class="o">+=</span> <span class="n">cluster_pmps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_pmp</span>

            <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;p_space_cluster</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cluster_spaceps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_spacep</span>
            <span class="n">total_clusters_spaceprobs</span> <span class="o">+=</span> <span class="n">cluster_spaceps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_spacep</span>

        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;p_field&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">total_clusters_probs</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;p_pm_field&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">total_clusters_pmprobs</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;p_space_field&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">total_clusters_spaceprobs</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">representation_type</span> <span class="o">==</span> <span class="s2">&quot;spherical&quot;</span><span class="p">:</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;parallax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cartesian_to_polar</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;log10_parallax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;parallax&quot;</span><span class="p">])</span>
            <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Simón Pedro González.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>